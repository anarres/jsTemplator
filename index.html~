<html>
<head>
<link rel="stylesheet" type="text/css" href="style.css">

<script type="text/javascript" src="models.js"></script>
<script type="text/javascript" src="controllers.js"></script>
<script type="text/javascript" src="betterSplit.js"></script>
<script type="text/javascript" src="json_parse.js"></script>
<script type="text/javascript" src="jscolor/jscolor.js"></script>
<script type="text/javascript">

function foo() {
    alert('foo!');
}

var txt = '{"employees":[' +
'{"firstName":"John","lastName":"Doe" },' +
'{"firstName":"Anna","lastName":"Smith" },' +
'{"firstName":"Peter","lastName":"Jones" }]}';

obj = JSON.parse(txt);

//alert(obj.employees[1].firstName); 
//alert(obj.employees[1].lastName);

function maliciousFish(fileText) {
    var jstDataString = getData(fileText);
    var jstData = JSON.parse(jstDataString);

    var reps = [];
    for (var j=0; j<jstData["replacements"].length; j++) {
        var r = new Replacement(jstData["replacements"][j]["shortName"], jstData["replacements"][j]["niceName"], "", jstData["replacements"][j]["inputType"]);
        r.getSetContent(fileText);
        reps.push(r);
    }
    var output = "";
    for (var i=0; i<reps.length; i++) {
        if (reps[i].shortName.slice(0,4) != "menu") {
            document.getElementById('userInput').innerHTML += reps[i].userInputHTML();
        }
    }
}

function squidAndSharks() {

    // Get files
    var files = document.getElementById('fileselect').files;

    // For each file
    for (var i=0; i<files.length; i++) {
        var fileInfo = "Name: " + files[i].name + ", Type: " + files[i].type + ", Size: " + files[i].size;

        var reader = new FileReader();
        reader.onload = function(event) {
            var fileContents = event.target.result;
            //alert(fileContents.length);
            maliciousFish(fileContents);
        };
        reader.onerror = function(event) {
            console.error("File could not be read! Code " + event.target.error.code);
        };
        reader.readAsText(files[i]);
    }
}
</script>

</head>

<body>

<div id="container">

<h1>Foofurple simple website editor</h1>

<div>
	<label for="fileselect">To work on an existing project, please upload project files:</label>
	<input id="fileselect" name="fileselect[]" multiple="multiple" type="file" onchange="squidAndSharks()" />
</div>

<div id="userInput">

</div> <!--#userInput-->

<!--
Color chooser (use this to select 6-digit colour values):
 <input type="text" class="color" value="3496CF">
<button onclick='preview()'>Preview website</button>
-->

</div> <!--#container-->

</body>
</html>
